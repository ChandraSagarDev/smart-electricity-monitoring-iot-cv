<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enervise Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<!-- Dashboard Page: Shows consumption stats, graphs, and controls for the user -->
<body>
    <!-- Add notification div -->

    <!-- Improved Sidebar Navigation -->
    <div class="sidebar" id="sidebar">
        <!-- Logo with Collapse Toggle -->
        <div class="logo-container">
            <div class="logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                </svg>
                <span class="logo-text">Enervise</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <!-- Navigation Menu -->
        <nav class="nav-menu">
            <ul class="nav-list">
                <li class="nav-item" data-tooltip="Camera Feed">
                    <a href="/" class="nav-link">
                        <i class="fas fa-video"></i>
                        <span class="nav-text">Camera Feed</span>
                    </a>
                </li>
                <li class="nav-item active" data-tooltip="Dashboard">
                    <a href="/dashboard" class="nav-link">
                        <i class="fas fa-chart-line"></i>
                        <span class="nav-text">Dashboard</span>
                    </a>
                </li>
                <li class="nav-item" data-tooltip="Alerts">
                    <a href="/alerts" class="nav-link">
                        <i class="fas fa-bell"></i>
                        <span class="nav-text">Alerts</span>
                        <span class="nav-badge" id="alerts-count">{{ alert_count }}</span>
                    </a>
                </li>
                <li class="nav-item" data-tooltip="Profile">
                    <a href="/profile" class="nav-link">
                        <i class="fas fa-user"></i>
                        <span class="nav-text">Profile</span>
                    </a>
                </li>
            </ul>
        </nav>
        
        <!-- User Profile Section -->
        <div class="user-profile">
            <div class="profile-info">
                <img src="https://ui-avatars.com/api/?name={{ user_name }}&background=4361ee&color=fff" alt="User" class="user-avatar">
                <div class="user-details">
                    <div class="user-name">{{ user_name }}</div>
                    <div class="user-role">Administrator</div>
                </div>
            </div>
            <div class="profile-actions">
                <button class="profile-btn" title="Notifications">
                    <i class="fas fa-bell"></i>
                </button>
                <button class="profile-btn logout-btn" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
        <div class="header">
            <h1><i class="fas fa-chart-line"></i> Energy Consumption Dashboard</h1>
            <div class="time-selector">
                <select id="timeRange">
                    <option value="day">Last 24 Hours</option>
                    <option value="week">Last Week</option>
                    <option value="month" selected>Last 30 Days</option>
                </select>
                <button id="applyRange" class="btn-primary">
                    <i class="fas fa-check"></i> Apply
                </button>
            </div>
        </div>
        
        <!-- Cost Limit Circle Graph -->
        <div class="card">
            <h2 class="card-title"><i class="fas fa-money-bill-wave"></i> Daily Cost Limit Usage</h2>
            <div class="circular-progress">
                <canvas id="limitChart"></canvas>
                <div class="limit-info">
                    <div class="limit-value" id="limitUsedPercent">0.0%</div>
                    <div class="limit-label" id="limitLabel">Please set a daily limit</div>
                    <div class="limit-remaining" id="limitRemaining" style="color: var(--warning);">No limit set</div>
                </div>
            </div>
            <div class="cost-limit-controls">
                <div class="limit-form">
                    <input type="number" id="costLimit" class="cost-limit-input" placeholder="Daily limit (₹)" min="0" step="0.01">
                    <button onclick="setCostLimit()" class="set-btn">
                        <i class="fas fa-check"></i> Set Limit
                    </button>
                    <button onclick="clearCostLimit()" class="clear-btn">
                        <i class="fas fa-times"></i> Clear Limit
                    </button>
                </div>
                <button onclick="clearAllReadings()" class="clear-all-btn">
                    <i class="fas fa-trash-alt"></i> Clear All Readings
                </button>
            </div>
        </div>
        
        <!-- Consumption Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Current Consumption</div>
                <div class="stat-value" id="currentReading">0 KWh</div>
                <div class="stat-label">Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Avg Daily Usage</div>
                <div class="stat-value" id="avgDailyUsage">0 KWh</div>
                <div class="stat-label">Last 30 Days</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Cost This Month</div>
                <div class="stat-value" id="currentBill">₹0</div>
                <div class="stat-label">Current Bill</div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="card-title"><i class="fas fa-chart-line"></i> Consumption Trend</h2>
            <div class="chart-container">
                <canvas id="consumption-chart"></canvas>
            </div>
        </div>
        
        <div class="card">
            <h2 class="card-title"><i class="fas fa-clock"></i> Peak Usage Hours</h2>
            <div class="chart-container">
                <canvas id="peak-hours-chart"></canvas>
            </div>
        </div>
        
        <div class="card ai-insights">
            <h2 class="card-title"><i class="fas fa-lightbulb"></i> AI Insights & Recommendations</h2>
            <div id="ai-insights-container">
                <!-- Sample insights - these will be replaced with dynamic data -->
                <div class="insight">
                    <div class="insight-category">Usage Pattern</div>
                    <div class="insight-text">Your consumption peaks between 6-9 PM daily, accounting for 32% of your total usage.</div>
                </div>
                <div class="insight">
                    <div class="insight-category">Comparison</div>
                    <div class="insight-text">You're using 15% more than similar households in your area.</div>
                    <div class="suggestion">Consider shifting laundry loads to off-peak hours to reduce costs.</div>
                </div>
                <div class="insight">
                    <div class="insight-category">Savings Opportunity</div>
                    <div class="insight-text">You could save approximately ₹1,200/month by adjusting your AC usage by 2°C.</div>
                </div>
            </div>
        </div>
    </div>

     <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>