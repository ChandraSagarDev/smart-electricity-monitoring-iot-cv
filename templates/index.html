<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KWh Meter Reader | Enervise</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
</head>
<!-- Index Page: Landing page for authenticated users, shows navigation and quick info -->
<body>
    <!-- Add notification div -->
    <div class="notification" id="notification"></div>

    <!-- Improved Sidebar Navigation -->
    <div class="sidebar">
        <!-- Logo with Collapse Toggle -->
        <div class="logo-container">
            <div class="logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                </svg>
                <span class="logo-text">Enervise</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <!-- Navigation Menu -->
        <nav class="nav-menu">
            <ul class="nav-list">
                <li class="nav-item active" data-tooltip="Camera Feed">
                    <a href="/" class="nav-link">
                        <i class="fas fa-video"></i>
                        <span class="nav-text">Camera Feed</span>
                    </a>
                </li>
                <li class="nav-item" data-tooltip="Dashboard">
                    <a href="/dashboard" class="nav-link">
                        <i class="fas fa-chart-line"></i>
                        <span class="nav-text">Dashboard</span>
                    </a>
                </li>
                <li class="nav-item" data-tooltip="Alerts">
                    <a href="/alerts" class="nav-link">
                        <i class="fas fa-bell"></i>
                        <span class="nav-text">Alerts</span>
                        <span class="nav-badge" id="alerts-count">{{ alert_count }}</span>
                    </a>
                </li>
                <li class="nav-item" data-tooltip="Profile">
                    <a href="/profile" class="nav-link">
                        <i class="fas fa-user"></i>
                        <span class="nav-text">Profile</span>
                    </a>
                </li>
            </ul>
        </nav>
        
        <!-- User Profile Section -->
        <div class="user-profile">
            <div class="profile-info">
                <img src="https://ui-avatars.com/api/?name={{ user_name }}&background=4361ee&color=fff" alt="User" class="user-avatar">
                <div class="user-details">
                    <div class="user-name">{{ user_name }}</div>
                    <div class="user-role">Administrator</div>
                </div>
            </div>
            <div class="profile-actions">
                <button class="profile-btn" title="Notifications">
                    <i class="fas fa-bell"></i>
                </button>
                <button class="profile-btn logout-btn" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
        <div class="header-status">
            <div>Next Capture In: <span id="next-capture-in">N/A</span> seconds</div>
            <div>Next Capture At: <span id="next-capture-time">N/A</span></div>
        </div>
        
        <div class="container">
            <div class="video-container">
                <h2 class="section-title"><i class="fas fa-video"></i> Live Camera Feed</h2>
                
                <div class="phase-selector">
                    <label for="phase-type">Select Meter Type:</label>
                    <select id="phase-type">
                        <option value="single" selected>Single Phase</option>
                        <option value="three">Three Phase</option>
                    </select>
                    <button onclick="updatePhase()" class="btn-outline">
                        <i class="fas fa-sync-alt"></i> Update Phase
                    </button>
                </div>
                
                <div class="btn-group">
                    <button class="btn-primary" onclick="startProcess()">
                        <i class="fas fa-play"></i> Start Process
                    </button>
                    <button class="btn-warning" onclick="stopProcess()">
                        <i class="fas fa-stop"></i> Stop Process
                    </button>
                </div>
                
                <div class="video-feed">
                    <img src="{{ url_for('video_feed') }}" alt="Live Camera Feed">
                </div>
                
                <div class="reading-card">
                    <div class="reading-label">Latest Reading</div>
                    <div class="reading-value">
                        <span id="reading">{{ last_reading }}</span>
                        <div style="font-size: 16px; color: #666; margin-top: 5px;">
                            <i class="far fa-clock"></i> <span id="reading-time">{{ last_reading_time if last_reading_time else 'N/A' }}</span>
                        </div>
                    </div>
                </div>
                
                <div class="bill-card">
                    <div class="bill-label">Bill Amount</div>
                    <div class="bill-value">
                        <span id="bill-amount">â‚¹0.00</span>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3>Initial Reading</h3>
                    <div id="initialReading">Not set</div>
                </div>
                <div class="info-section">
                    <h3>Calculation Details</h3>
                    <div id="readingStatus" style="white-space: pre-wrap;">Not started</div>
                </div>
                
                <div class="debug-info" id="debug-info" style="display: none;">
                    {{ debug_info }}
                </div>
            </div>
            
            <div class="readings-container">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 class="section-title"><i class="fas fa-history"></i> Reading History</h2>
                    <button onclick="clearAllReadings()" class="clear-btn">
                        <i class="fas fa-trash-alt"></i> Clear All
                    </button>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>Reading</th>
                            <th>Time</th>
                            <th>Bill Amount</th>
                        </tr>
                    </thead>
                    <tbody id="readings-table">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/index.js') }}"></script>
</body>
</html>